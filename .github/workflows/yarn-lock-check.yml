name: Yarn Lock Check

on:
  pull_request:
    branches: [ main, develop ]
  push:
    branches: [ main, develop ]

jobs:
  check-yarn-lock:
    runs-on: ubuntu-latest
    name: Check yarn.lock files exist
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Check root yarn.lock exists
        run: |
          if [ ! -f "yarn.lock" ]; then
            echo "❌ Error: yarn.lock file is missing in the root directory"
            echo "Please run 'yarn install' to generate the yarn.lock file"
            exit 1
          fi
          echo "✅ Root yarn.lock file exists"
          
      - name: Check frontend yarn.lock exists
        run: |
          if [ ! -f "frontend/yarn.lock" ]; then
            echo "❌ Error: yarn.lock file is missing in the frontend directory"
            echo "Please run 'cd frontend && yarn install' to generate the yarn.lock file"
            exit 1
          fi
          echo "✅ Frontend yarn.lock file exists"
          
      - name: Verify yarn.lock files are not empty
        run: |
          if [ ! -s "yarn.lock" ]; then
            echo "❌ Error: Root yarn.lock file exists but is empty"
            exit 1
          fi
          if [ ! -s "frontend/yarn.lock" ]; then
            echo "❌ Error: Frontend yarn.lock file exists but is empty"
            exit 1
          fi
          echo "✅ All yarn.lock files are present and non-empty"